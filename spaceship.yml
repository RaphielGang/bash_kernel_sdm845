kind: pipeline
name: Disrupt Kernel Droneship

clone:
  depth: 1

steps:
- name: clone_dependencies
  image: raphielscape/spinsinfra:fedora
  commands:
    - git clone --depth=1 --recursive https://github.com/raphielscape/scripts buildscripts
    - git clone --depth=1 https://github.com/raphielscape/AnyKernel2.git --branch "sdm845" anykernel
    - git clone --depth=1 https://github.com/RaphielGang/aarch64-raph-linux-android.git arm64cc
    - git clone --depth=1 https://github.com/RaphielGang/arm-linux-gnueabi-8.x.git armcc

- name: do_beryllium
  image: raphielscape/spinsinfra:fedora
  environment:
    BOT_API_KEY:
      from_secret: BOT_API_KEY
    EXEC: beryllium
    CC: GCC
    KERNELDIR: /drone/src/
  commands:
    - ./buildscripts/kernel.sh
  when:
    branch:
      - rebase-sdm-10

- name: do_dipper
  image: raphielscape/spinsinfra:fedora
  environment:
    BOT_API_KEY:
      from_secret: BOT_API_KEY
    EXEC: dipper
    CC: GCC
    KERNELDIR: /drone/src/
  commands:
    - ./buildscripts/kernel.sh
  when:
    branch:
      - rebase-sdm-10
